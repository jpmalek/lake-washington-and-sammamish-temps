name: CI deployment; run tests via pytest

on:
    push:
        branches:
            - main
    workflow_dispatch:

permissions: write-all   
    
jobs:
    build:

        runs-on: ubuntu-latest

        steps:
        - uses: actions/checkout@v4.1.1
        - name: Set up Python 3.8
          uses: actions/setup-python@v5.0.0
          with:
                python-version: 3.8
        - name: Install dependencies
          run: |
                python -m pip install --upgrade pip
                pip install -r requirements.txt
        - name: Run tests
          run: |
                pytest test_app.py --cov=app --cov-report html
        - name: List htmlcov directory
          run: ls /home/runner/work/lake_washington_and_sammamish_temps/lake_washington_and_sammamish_temps/htmlcov
        - name: GitHub Pages action
          uses: peaceiris/actions-gh-pages@v3.9.3
          with:
           publish_dir: /home/runner/work/lake_washington_and_sammamish_temps/lake_washington_and_sammamish_temps/htmlcov
           github_token: ${{ secrets.GITHUB_TOKEN }}
           allow_empty_commit: true       
    